const APIResponse = require("../utils/APIResponse");
const APIError = require("../utils/APIError");
const asyncHandler = require("../utils/asyncHandler");

// Sample controller to demonstrate the recommended structure
// Remove this file when implementing actual business logic

const sampleController = {
  // Get public data - no authentication required
  getPublicData: asyncHandler(async (req, res) => {
    const data = {
      message: "This is public data",
      timestamp: new Date().toISOString(),
    };

    return APIResponse.send(
      res,
      true,
      200,
      "Public data retrieved successfully",
      data,
    );
  }),

  // Get protected data - authentication required
  getProtectedData: asyncHandler(async (req, res) => {
    const data = {
      message: "This is protected data",
      user: req.user, // Available because of auth middleware
      timestamp: new Date().toISOString(),
    };

    return APIResponse.send(
      res,
      true,
      200,
      "Protected data retrieved successfully",
      data,
    );
  }),

  // Create a new resource
  createResource: asyncHandler(async (req, res) => {
    const { name, description } = req.body;

    // Basic validation example
    if (!name) {
      throw APIError.badRequest("Name is required");
    }

    // Simulate resource creation
    const newResource = {
      id: Date.now(), // In real app, this would be generated by database
      name,
      description,
      createdBy: req.user?.id,
      createdAt: new Date().toISOString(),
    };

    return APIResponse.send(
      res,
      true,
      201,
      "Resource created successfully",
      newResource,
    );
  }),

  // Update an existing resource
  updateResource: asyncHandler(async (req, res) => {
    const { id } = req.params;
    const updates = req.body;

    // Simulate finding resource
    if (!id || id === "999") {
      // Simulate not found
      throw APIError.notFound("Resource not found");
    }

    // Simulate resource update
    const updatedResource = {
      id,
      ...updates,
      updatedBy: req.user?.id,
      updatedAt: new Date().toISOString(),
    };

    return APIResponse.send(
      res,
      true,
      200,
      "Resource updated successfully",
      updatedResource,
    );
  }),

  // Delete a resource
  deleteResource: asyncHandler(async (req, res) => {
    const { id } = req.params;

    // Simulate finding resource
    if (!id || id === "999") {
      // Simulate not found
      throw APIError.notFound("Resource not found");
    }

    // Simulate deletion (in real app, would delete from database)

    return APIResponse.send(res, true, 200, "Resource deleted successfully");
  }),

  // Admin only endpoint
  getAdminData: asyncHandler(async (req, res) => {
    const adminData = {
      message: "This is admin-only data",
      statistics: {
        totalUsers: 150,
        totalResources: 75,
        systemHealth: "good",
      },
      timestamp: new Date().toISOString(),
    };

    return APIResponse.send(
      res,
      true,
      200,
      "Admin data retrieved successfully",
      adminData,
    );
  }),
};

module.exports = sampleController;
